<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roommate Style Quiz - UniMates</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="mobile.css">
  <link rel="stylesheet" href="quiz-desktop.css">
</head>
<body class="quiz-page-body">
  <div class="bg-animation"></div>
  
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>
  <div class="orb orb3"></div>

  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <img src="logo.png" alt="UniMates Logo">
        <span class="logo-text">UniMates</span>
      </a>
      <a href="quiz.html" class="quiz-header-ad">
        <span class="quiz-header-ad-icon">✨</span>
        <span class="quiz-header-ad-text">Take the Personality Quiz!</span>
      </a>
      <button class="hamburger" onclick="toggleMenu(this)" aria-label="Toggle navigation menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="how-it-works.html">How it works</a></li>
        <li><a href="about.html">About us</a></li>
      </ul>
    </div>
    <div class="mobile-overlay" onclick="closeMenu()"></div>
  </nav>

  <header class="quiz-header">
    <h1 class="section-title">What's Your Roommate Style?</h1>
    <p class="section-subtitle">
      Answer a few questions to discover your living preferences and find compatible flatmates.
    </p>
    <div class="quiz-progress">
      <div class="progress-bar" id="progress"></div>
    </div>
  </header>

  <main class="quiz-container">
    <div class="question-card" id="questionCard">
      <div class="question-number">Question <span id="currentQuestion">1</span> of 10</div>
      <div class="question-text" id="questionText"></div>
      <div class="options-grid" id="options"></div>
      <div class="quiz-navigation">
        <button class="nav-button" id="prevBtn" style="display: none;">Previous</button>
        <button class="nav-button next" id="nextBtn">Next</button>
      </div>
    </div>

    <div class="results-section" id="resultsSection">
      <h2 class="section-title">Your Results Are Ready!</h2>
      
      <div class="results-preview">
        <div class="results-teaser" id="resultsTeaser"></div>
        <div class="results-overlay">
          <div class="results-lock-icon">🔒</div>
          <h3 class="results-lock-title">Unlock Your Full Results</h3>
          <p class="results-lock-description">
            Join our waitlist to see your complete personality profile and start connecting with compatible roommates!
          </p>
          <form id="waitlistForm" class="waitlist-form">
            <input type="email" id="email" placeholder="Enter your email address" required />
            <label class="waitlist-checkbox-label" style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.88rem; color: var(--text-dim); margin-top: 0.2rem; font-weight: 400;">
              <input type="checkbox" id="waitlist-accept" required style="accent-color: var(--accent); width: 1rem; height: 1rem; border-radius: 5px; margin-right: 0.4rem;" />
              I agree to receive updates, beta invitations, and occasional emails from UniMates. I understand I can unsubscribe at any time.
            </label>
            <button type="submit" class="cta-button">Join Waitlist</button>
          </form>
          <div id="successMessage" class="success-message" style="display:none;">
            🎉 You're on the list! Check out your complete results below.
          </div>
        </div>
      </div>
      
      <div class="full-results" id="fullResults"></div>
    </div>
  </main>
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-cube-container">
        <div class="cube" tabindex="0">
          <div class="cube-face cube-face-front"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
          <div class="cube-face cube-face-back"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
          <div class="cube-face cube-face-right"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
          <div class="cube-face cube-face-left"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
          <div class="cube-face cube-face-top"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
          <div class="cube-face cube-face-bottom"><img src="logo.svg" alt="Logo" width="60" height="60"></div>
        </div>
      </div>
      <div class="footer-social">
        <a href="https://instagram.com/unimates.info" target="_blank" aria-label="Instagram" class="footer-social-link"><i class="fab fa-instagram"></i></a>
        <a href="https://tiktok.com/@unimatesapp" target="_blank" aria-label="TikTok" class="footer-social-link"><i class="fab fa-tiktok"></i></a>
        <a href="https://www.youtube.com/channel/UCMKHVISj443ioGYAZYRUrTQ" target="_blank" aria-label="YouTube" class="footer-social-link"><i class="fab fa-youtube"></i></a>
        <a href="https://www.linkedin.com/company/unimatesapp" target="_blank" aria-label="LinkedIn" class="footer-social-link"><i class="fab fa-linkedin"></i></a>
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=info@unimates.net&su=Regarding Your Inquiry&body=Dear Unimates Team,"aria-label="Email" class="footer-social-link"><i class="fas fa-envelope"></i></a></div>
      </div>
    </div>
    <div class="footer-copy">&copy; 2025 UniMates. All rights reserved. | <a href="Privacy-policy.html" style="color: var(--accent); text-decoration: none;">Privacy Policy</a></div>
  </footer>

  <canvas id="confetti-canvas"></canvas>

  <script src="shared.js"></script>
  <script>
    // Page-specific functionality for quiz.html
    
    const questions = [
      {
        text: "How do you typically spend your evenings at home?",
        options: [
          { icon: "🎮", text: "Gaming or watching movies", value: "entertainment" },
          { icon: "📚", text: "Studying or reading", value: "studious" },
          { icon: "🎨", text: "Creative hobbies", value: "creative" },
          { icon: "👥", text: "Socializing with friends", value: "social" }
        ]
      },
      {
        text: "What's your ideal noise level at home?",
        options: [
          { icon: "🤫", text: "Complete silence", value: "quiet" },
          { icon: "📱", text: "Background noise is fine", value: "moderate" },
          { icon: "🎵", text: "Music and conversation", value: "lively" },
          { icon: "🎉", text: "The livelier, the better", value: "vibrant" }
        ]
      },
      {
        text: "How do you prefer to handle household chores?",
        options: [
          { icon: "📋", text: "Strict cleaning schedule", value: "organized" },
          { icon: "🤝", text: "Share tasks as needed", value: "flexible" },
          { icon: "✨", text: "Clean when it gets messy", value: "relaxed" },
          { icon: "💰", text: "Hire cleaning service", value: "outsource" }
        ]
      },
      {
        text: "What's your typical sleep schedule?",
        options: [
          { icon: "🌅", text: "Early bird (Before 6 AM)", value: "early" },
          { icon: "☀️", text: "Morning person (6-8 AM)", value: "morning" },
          { icon: "🌙", text: "Night owl (After midnight)", value: "night" },
          { icon: "⭐", text: "Varies day to day", value: "flexible" }
        ]
      },
      {
        text: "How often do you cook at home?",
        options: [
          { icon: "👨‍🍳", text: "Love cooking daily", value: "chef" },
          { icon: "🥗", text: "Cook simple meals", value: "casual" },
          { icon: "🔄", text: "Meal prep weekly", value: "prep" },
          { icon: "🚶", text: "Prefer takeout/eating out", value: "takeout" }
        ]
      },
      {
        text: "How do you feel about sharing items?",
        options: [
          { icon: "🤲", text: "Happy to share everything", value: "communal" },
          { icon: "🔄", text: "Share with clear boundaries", value: "selective" },
          { icon: "🔒", text: "Prefer keeping things separate", value: "private" },
          { icon: "💭", text: "Depends on the item", value: "flexible" }
        ]
      },
      {
        text: "What's your approach to guests?",
        options: [
          { icon: "🎉", text: "Love hosting often", value: "social" },
          { icon: "👥", text: "Occasional small gatherings", value: "moderate" },
          { icon: "🤝", text: "Only close friends", value: "selective" },
          { icon: "🏠", text: "Prefer private space", value: "private" }
        ]
      },
      {
        text: "How do you handle conflicts?",
        options: [
          { icon: "💬", text: "Address immediately", value: "direct" },
          { icon: "🤝", text: "Find compromise", value: "diplomatic" },
          { icon: "📝", text: "Write it down first", value: "thoughtful" },
          { icon: "🕊️", text: "Avoid confrontation", value: "passive" }
        ]
      },
      {
        text: "What's your ideal weekend activity?",
        options: [
          { icon: "🏃", text: "Active and outdoors", value: "active" },
          { icon: "🎮", text: "Relaxing at home", value: "homebody" },
          { icon: "🎨", text: "Creative projects", value: "creative" },
          { icon: "🎉", text: "Social activities", value: "social" }
        ]
      },
      {
        text: "What's most important to you in a living space?",
        options: [
          { icon: "🏠", text: "Peace and quiet", value: "tranquil" },
          { icon: "🎨", text: "Creative inspiration", value: "inspiring" },
          { icon: "👥", text: "Social atmosphere", value: "communal" },
          { icon: "📚", text: "Productive environment", value: "focused" }
        ]
      }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = [];

    const questionCard = document.getElementById('questionCard');
    const resultsSection = document.getElementById('resultsSection');
    const currentQuestionSpan = document.getElementById('currentQuestion');
    const questionText = document.getElementById('questionText');
    const optionsGrid = document.getElementById('options');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressBar = document.getElementById('progress');

    function updateQuestion() {
      const question = questions[currentQuestionIndex];
      currentQuestionSpan.textContent = currentQuestionIndex + 1;
      questionText.textContent = question.text;
      
      optionsGrid.innerHTML = '';
      question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'answer-option';
        optionDiv.innerHTML = `
          <div class="option-icon">${option.icon}</div>
          <div class="option-text">${option.text}</div>
        `;
        if (userAnswers[currentQuestionIndex] === option.value) {
          optionDiv.classList.add('selected');
          optionDiv.innerHTML += `<span class=\"selection-indicator\" aria-label=\"Selected\" title=\"Selected\">✔</span>`;
        }
        optionDiv.addEventListener('click', () => {
          document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
          document.querySelectorAll('.selection-indicator').forEach(el => el.remove());
          optionDiv.classList.add('selected');
          optionDiv.innerHTML += `<span class=\"selection-indicator\" aria-label=\"Selected\" title=\"Selected\">✔</span>`;
          userAnswers[currentQuestionIndex] = option.value;
          nextBtn.disabled = false;
          nextBtn.classList.remove('disabled');
        });
        optionsGrid.appendChild(optionDiv);
      });
      
      prevBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'block';
      nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? 'See Results' : 'Next';
      
      const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
      progressBar.style.width = progress + '%';
    }

    prevBtn.addEventListener('click', () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        updateQuestion();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (userAnswers[currentQuestionIndex]) {
        if (currentQuestionIndex < questions.length - 1) {
          currentQuestionIndex++;
          updateQuestion();
        } else {
          showResults();
        }
      }
    });

    function showResults() {
      questionCard.style.display = 'none';
      resultsSection.style.display = 'block';

      const result = calculateResult();
      const resultsTeaser = document.getElementById('resultsTeaser');
      resultsTeaser.innerHTML = `
        <div class="results-preview-content">
          <div class="results-preview-icon">${result.icon}</div>
          <h3 class="results-preview-title">${result.title}</h3>
          <p class="results-preview-description">${result.description}</p>
        </div>
      `;
    }

    function calculateResult() {
      const personalityTypes = {
        "social": {
          title: "The Social Butterfly",
          icon: "🦋",
          description: "You thrive in lively environments and love connecting with people.",
          traits: [
            { label: "Social Energy", value: "High" },
            { label: "Communication", value: "Excellent" },
            { label: "Adaptability", value: "Very High" }
          ],
          compatibleWith: ["creative", "active"]
        },
        "studious": {
          title: "The Focused Scholar",
          icon: "📚",
          description: "You value quiet study time and organization.",
          traits: [
            { label: "Focus", value: "High" },
            { label: "Organization", value: "Excellent" },
            { label: "Discipline", value: "Very High" }
          ],
          compatibleWith: ["organized", "quiet"]
        },
        "creative": {
          title: "The Creative Spirit",
          icon: "🎨",
          description: "You bring art and inspiration to your living space.",
          traits: [
            { label: "Creativity", value: "High" },
            { label: "Expression", value: "Excellent" },
            { label: "Innovation", value: "Very High" }
          ],
          compatibleWith: ["social", "inspiring"]
        },
        "organized": {
          title: "The Organized Planner",
          icon: "📋",
          description: "You love structure and keeping things in order.",
          traits: [
            { label: "Organization", value: "High" },
            { label: "Planning", value: "Excellent" },
            { label: "Reliability", value: "Very High" }
          ],
          compatibleWith: ["studious", "focused"]
        }
      };

      // Simple scoring system - count most common answers
      const answerCounts = {};
      userAnswers.forEach(answer => {
        answerCounts[answer] = (answerCounts[answer] || 0) + 1;
      });

      let dominantType = "social"; // default
      let maxCount = 0;
      
      Object.keys(answerCounts).forEach(type => {
        if (answerCounts[type] > maxCount) {
          maxCount = answerCounts[type];
          dominantType = type;
        }
      });

      return personalityTypes[dominantType] || personalityTypes["social"];
    }

    // Waitlist Form Handling
    const waitlistForm = document.getElementById('waitlistForm');
    const emailInput = document.getElementById('email');
    const successMessage = document.getElementById('successMessage');
    const resultsOverlay = document.querySelector('.results-overlay');
    const checkbox = document.getElementById('waitlist-accept');
    const submitButton = waitlistForm.querySelector('.cta-button');

    function validateForm() {
      const emailValid = emailInput.value.trim() !== '';
      const checkboxValid = checkbox.checked;
      const isValid = emailValid && checkboxValid;
      
      submitButton.disabled = !isValid;
      if (isValid) {
        submitButton.classList.remove('disabled');
        } else {
        submitButton.classList.add('disabled');
      }
    }

    emailInput.addEventListener('input', validateForm);
    checkbox.addEventListener('change', validateForm);

    // Initial validation
    validateForm();

    waitlistForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = emailInput.value;
      
      // Basic validation
      if(!email) return;

      try {
        const response = await fetch('http://127.0.0.1:8000/suncribers', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email, answers: userAnswers })
        });
        
        if (response.ok) {
          successMessage.style.display = 'block';
      waitlistForm.style.display = 'none';
      document.querySelector('.results-lock-icon').style.display = 'none';
      document.querySelector('.results-lock-title').style.display = 'none';
      document.querySelector('.results-lock-description').style.display = 'none';
          
          resultsOverlay.style.backdropFilter = 'none';
          resultsOverlay.style.background = 'none';
          
          // Confetti
          const canvas = document.getElementById('confetti-canvas');
          const confetti = window.confetti;
          canvas.style.display = 'block';
          confetti({
            particleCount: 150,
            spread: 80,
            origin: { y: 0.6 }
          });

          // Reveal full results
          setTimeout(() => {
              fullResultsContainer.style.maxHeight = fullResultsContainer.scrollHeight + 'px';
              fullResultsContainer.style.opacity = '1';
          }, 200);


        } else {
          const errorData = await response.json();
          alert(`Error: ${errorData.detail || 'Could not join waitlist.'}`);
        }
      } catch (error) {
        console.error('Submission error:', error);
        alert('Connection error. Please try again later.');
      }
    });
    
    // Initial call
    updateQuestion();

    // Confetti from CDN
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "m9rfm9i445");
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js';
    document.body.appendChild(script);

  </script>
  <script src="view-switcher.js"></script>
</body>
</html>